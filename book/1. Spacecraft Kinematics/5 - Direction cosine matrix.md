# 5. Матрица направляющих косинусов

**Матрица направляющих косинусов (МНК)** — это матрица перехода (или матрица поворота). Это один из базовых способов описания ориентации, отличающийся универсальностью и удобством преобразования между различными методами описания углового положения спутника, которые мы рассмотрим в следующих главах.

## 5.1. Задание МНК

На рисунке ниже изображены две системы координат:  

- **инерциальная система** с ортами $\overline{i}_{1}, \overline{i}_{2}, \overline{i}_{3}$,
- **связанная система** с ортами $\overline{b}_{1}, \overline{b}_{2}, \overline{b}_{3}$.

![](pics/kin_dcm_definition.svg)

Связь между ортами этих базисов выражается следующими уравнениями:

$$
\begin{matrix}
\overline{b}_{1}=\cos\alpha_{11} \overline{i}_{1} + \cos\alpha_{12} \overline{i}_{2} + \cos\alpha_{13} \overline{i}_{3}, \\
\overline{b}_{2}=\cos\alpha_{21} \overline{i}_{1} + \cos\alpha_{22} \overline{i}_{2} + \cos\alpha_{23} \overline{i}_{3}, \\
\overline{b}_{3}=\cos\alpha_{31} \overline{i}_{1} + \cos\alpha_{32} \overline{i}_{2} + \cos\alpha_{33} \overline{i}_{3}.
\end{matrix}
$$

Или в матричном виде:

$$
\begin{pmatrix} 
	\overline{b}_{1} \\ \overline{b}_{2} \\ \overline{b}_{3} 
\end{pmatrix} =
\begin{pmatrix} 
	\cos\alpha_{11} & \cos\alpha_{12} & \cos\alpha_{13} \\  
	\cos\alpha_{21} & \cos\alpha_{22} & \cos\alpha_{23} \\  
	\cos\alpha_{31} & \cos\alpha_{32} & \cos\alpha_{33}
\end{pmatrix} 
\begin{pmatrix} 
	\overline{i}_{1} \\ \overline{i}_{2} \\ \overline{i}_{3} 
\end{pmatrix} = 
\textbf{C}
\begin{pmatrix} 
	\overline{i}_{1} \\ \overline{i}_{2} \\ \overline{i}_{3} 
\end{pmatrix}.
$$

Здесь матрица $\textbf{C}$  - матрица направляющих косинусов, задающая ориентацию одной системы координат относительно другой. В данном случае — $\text{B}$ относительно $\text{I}$. Из вида данной матрицы понятно, почему она так называется.

>Далее, где это необходимо, будем конкретизировать ориентацию чего относительно чего описывает матрица $\textbf{C}$ в виде нижнего индекса или пояснения в скобках. Например, $\textbf{C}_{\text{I} \rightarrow \text{B}}$ или $\textbf{C}(\text{I} \rightarrow \text{B})$ будет обозначать, что матрица описывает ориентацию системы координат $\text{B}$ относительно $\text{I}$, т.е. переход из $\text{B}$ в $\text{I}$.

## 5.2. Обратное преобразование  

Если требуется выразить обратный переход, то легко можно увидеть, что для этого надо лишь транспонировать матрицу $\textbf{C}$:

$$
\begin{pmatrix} 
	\overline{i}_{1} \\ \overline{i}_{2} \\ \overline{i}_{3} 
\end{pmatrix} =
\begin{pmatrix} 
	\cos\alpha_{11} & \cos\alpha_{21} & \cos\alpha_{31} \\  
	\cos\alpha_{12} & \cos\alpha_{22} & \cos\alpha_{32} \\  
	\cos\alpha_{13} & \cos\alpha_{23} & \cos\alpha_{33}
\end{pmatrix} 
\begin{pmatrix} 
	\overline{b}_{1} \\ \overline{b}_{2} \\ \overline{b}_{3} 
\end{pmatrix} = 
\textbf{C} ^ {T}
\begin{pmatrix} 
	\overline{b}_{1} \\ \overline{b}_{2} \\ \overline{b}_{3} 
\end{pmatrix}\tag{5.1}
$$

## 5.3. Свойства матрицы направляющих косинусов

1) Элементы матрицы направляющих косинусов определяются как скалярные произведения соответствующих базисных векторов:  

$$
\textbf{C}_{mn} = \cos(\angle \overline{b}_{m}, \overline{i}_{n}) =  \overline{b}_{m} \cdot  \overline{i}_{n}.
$$

2) Обратная матрица равна транспонированной:  
   $$ \textbf{C}^{-1} = \textbf{C}^{T} $$

   Это следует из пункта **обратное преобразование**. Матрицы с таким свойством называются **ортогональными**.

3) Модуль определителя **МНК** всегда равен 1.

   Действительно, из пункта **2** следует, что 
   
$$ 
\det(\textbf{C}\textbf{C}^T)=\det(\textbf{I}_{3x3})=1. 
$$
   
   Т.к. матрица квадратная, то 
   
$$ 
\det(\textbf{C}\textbf{C}^T) = \det{\textbf{C}}\det{\textbf{C}}^T = (\det{\textbf{C}})^2 = 1 \leftrightarrow \det\textbf{C} = \pm 1. 
$$
   
   Для правосторонней системы координат $\det(\textbf{C}) = 1$, а для левосторонней $\det(\textbf{C}) = -1$. Например, если **МНК** с определителем $-1$ имеет следующий вид: 
   
$$
\textbf{C} = 
\begin{pmatrix}
	1 & 0 & 0 \\ 
	0 & 0 & 1 \\ 
	0 & 1 & 0
\end{pmatrix},
$$

   то она просто меняет местами 2-ую и 3-ю оси, что превращается матрицу в левую. 

4) **МНК** позволяет преобразовывать координаты векторов между системами координат:

$$\overline{r}^{\text{B}} = \textbf{C}_{\text{I} \rightarrow \text{B}} \overline{r}^{\text{I}}.$$

5) С помощью **МНК** можно легко складывать повороты. 

   Если известны матрицы поворота $\textbf{C}_{\text{X}_1 \rightarrow \text{X}_2}$ и $\textbf{C}_{\text{X}_2 \rightarrow \text{X}_3}$, то поворот из $\text{X}_1$ в $\text{X}_2$ находитcя по формуле:  
   
$$\textbf{C}_{\text{X}_1 \rightarrow \text{X}_3} = \textbf{C}_{\text{X}_2 \rightarrow \text{X}_3} \textbf{C}_{\text{X}_1 \rightarrow \text{X}_2}.$$

   Перемножение идёт **справа налево**.

6) Длины строк и столбцов равны 1, а каждый элемент по модулю не превосходит единицы: 
   
$$ 
\sum_{n=1}^{3} \textbf{C}_{mn}^2 = 1, \quad \sum_{m=1}^{3} \textbf{C}_{mn}^2 = 1,  \quad |\textbf{C}_{mn}| \le 1. 
$$

## 5.4. Кинематические уравнения

Изменение ориентации спутника во времени описывается дифференциальным уравнением кинематики:

$$
\dot{\textbf{C}} = -[\tilde \omega] \textbf{C},
$$

где $[\tilde \omega]$ — кососимметрическая матрица угловых скоростей:

$$
[\tilde \omega] = 
\begin{pmatrix} 
0 & -\omega_{3} & \omega_{2} \\ 
\omega_{3} & 0 & -\omega_{1} \\ 
-\omega_{2} & \omega_{1} & 0
\end{pmatrix}.
$$

Если рассматривается ориентация спутника относительно инерциальной системы, уравнение принимает следующую форму:

$$
\dot{\textbf{C}}_{\text{I} \rightarrow \text{B}} = -[\tilde{\omega}_{\text{B}/\text{I}}]\textbf{C}_{\text{I} \rightarrow \text{B}}.
$$

В главе **4** мы упоминали, что для описания пространственной ориентации необходимо минимум три координаты. Здесь же используется 9. Однако независимыми из них являются только 3. Остальные координаты можно найти из свойств **3** и **6** пункта **5.3**. При интегрировании накапливается ошибка, что приводит к тому, что эти условия перестают выполняться. Поэтому на практике важно проводить дополнительно ортогонализацию **МНК** - например, [ортогонализацию **Грамма-Шмидта**](https://en.wikipedia.org/wiki/Gram%E2%80%93Schmidt_process).

Пример численного решения уравнений кинематики без ортогонализации на языке **Python**:

```python
import matplotlib.pyplot as plt  
import numpy as np  
from scipy.integrate import solve_ivp  
  
  
def gyroscope_sensor(t: float) -> np.ndarray:  
    """Имитация измерений датчика угловых скоростей."""  
    omega = np.array([0.3 * np.sin(t), -0.05 * np.cos(t), np.sin(t) * np.cos(t)])  
    return omega  
  
  
def dcm_kinematic_right_hand_side(t: float, y: np.ndarray) -> np.ndarray:  
    """Правые части системы ОДУ, задающих кинематические уравнения."""  
    # Угловые скорости с датчика.  
    omega = gyroscope_sensor(t)  
    # Кососимметрическая матрица угловых скоростей.  
    omega_tilde = np.array(  
        [[0, -omega[2], omega[1]], [omega[2], 0, -omega[0]], [-omega[1], omega[0], 0]]  
    )  
    # Правые части кинематических уравнений.  
    rhs = -omega_tilde @ y.reshape(3, 3)  
    rhs = rhs.flatten()  
    return rhs  
  
  
# Начальная ориентация.  
y0 = np.array([[1, 0, 0], [0, 1, 0], [0, 0, 1]])  
y0 = y0.flatten()  
  
sol = solve_ivp(  
    dcm_kinematic_right_hand_side,  
    t_span=[0, 10],  
    y0=y0,  
    t_eval=np.arange(0, 10.1, 0.1),  
)  
  
# Время, с.  
time = sol.t  
  
plt.figure(figsize=(15, 5))  
for i in range(9):  
    plt.plot(time, sol.y[i, :], label=f"C{i // 3 + 1}{i % 3 + 1}")  
plt.xlabel("Время, с", fontsize=14)  
plt.ylabel("Компоненты МНК", fontsize=14)  
plt.legend()  
plt.grid()  
plt.show()
```

![](pics/kin_dcm_kinematic_equation.svg) 

## 5.5. Вывод кинематических уравнений

Воспользуемся уравнением 5.1, переписав его в более компактном виде:

$$
\hat{b} = \textbf{C} \hat{i},
$$

где $\hat{b} = (\overline{b}_1,\ \overline{b}_2,\ \overline{b}_3)^T$ и $\hat{i} = (\overline{i}_1,\ \overline{i}_2,\ \overline{i}_3)^T$, $\textbf{C} = \textbf{C}_{\text{I} \rightarrow \text{B}}$.

Найдем производную $\hat{b}$ в **ИСК**, используя правило дифференцирования произведения:

$$
\left(\dfrac{d\hat{b}}{dt}\right)^{\text{I}} = \dot{\textbf{C}} \hat{i} + \textbf{C}\left(\dfrac{d\hat{i}}{dt}\right)^{\text{I}} = \dot{\textbf{C}} \hat{i}.\tag{5.2}
$$

С другой стороны, используя **формулу Пуассона**:

$$
\left(\dfrac{d\hat{b}}{dt}\right)^{\text{I}} = -[\tilde{\omega}_{\text{B}/{\text{I}}}] \hat{b} = -[\tilde{\omega}_{\text{B}/{\text{I}}}] \textbf{C} \hat{i}.\tag{5.3}
$$

Приравнивая правые части уравнений (5.1) и (5.2), получим уравнение кинематики:

$$
\dot{\textbf{C}} = -[\tilde{\omega}_{\text{B}/\text{I}}]\textbf{C}.
$$

## 5.6. Заключение

Матрица направляющих косинусов - универсальный и удобный способ описания ориентации, позволяющий легко переходить между различными методами представления вращательного движения. Она основана на девяти параметрах, представляющих собой косинусы углов между соответствующими осями двух систем координат, и не подвержена особенностям, связанным с вырождениями, характерными для других методов.

Однако у данного подхода есть и недостатки. В частности, интерпретация ориентации по заданной матрице не всегда интуитивно очевидна. Кроме того, при численном интегрировании кинематических уравнений возникает накопление ошибок, что приводит к утрате ортогональности. Поэтому на практике требуется регулярная коррекция матрицы, например, с использованием метода ортогонализации Грамма-Шмидта.

Несмотря на эти сложности, матрица направляющих косинусов остается одним из ключевых инструментов в задачах анализа и управления ориентацией космических аппаратов благодаря своей универсальности и удобству.